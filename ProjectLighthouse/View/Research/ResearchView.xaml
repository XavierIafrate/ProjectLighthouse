<UserControl
    x:Class="View.Research.ResearchView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:ProjectLighthouse.ViewModel.ValueConverters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:gif="https://github.com/XamlAnimatedGif/XamlAnimatedGif"
    xmlns:local="clr-namespace:View.Research"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:uc="clr-namespace:ProjectLighthouse.View.UserControls"
    d:Background="White"
    d:DesignWidth="1445"
    mc:Ignorable="d">
    <Grid>
        <Grid.Resources>
            <converters:dateToLastModified x:Key="modifiedFormatter" />
            <converters:boolToVisibleOrCollapsed x:Key="boolToVisible" />
            <converters:boolToCollapsedOrVisible x:Key="boolToCollapsed" />
        </Grid.Resources>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" MinWidth="280" />
            <ColumnDefinition Width="3*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="auto" />
            </Grid.ColumnDefinitions>
            <TextBox
                x:Name="searchBox"
                Style="{StaticResource SearchBox}"
                Text="{Binding SearchString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            <Button
                x:Name="ClearButton"
                Grid.Column="1"
                Click="ClearButton_Click"
                Style="{StaticResource ClearButton}" />
        </Grid>

        <ListView
            Grid.Row="1"
            HorizontalContentAlignment="Stretch"
            d:ItemsSource="{d:SampleData ItemCount=10}"
            ItemsSource="{Binding FilteredProjects, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
            SelectedItem="{Binding SelectedProject, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Grid Margin="12,7">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock
                            VerticalAlignment="Center"
                            FontFamily="Consolas"
                            FontSize="16"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource Teal}"
                            Text="{Binding ProjectCode}" />
                        <TextBlock
                            Grid.Column="1"
                            Margin="5,0"
                            VerticalAlignment="Center"
                            FontWeight="SemiBold"
                            Text="{Binding ProjectName}" />
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <Grid Grid.Row="2" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Button
                Margin="0"
                Command="{Binding AddProjectCmd}"
                Style="{StaticResource Action_New_Button}"
                Tag="New Project" />
            <TextBlock
                Grid.Column="1"
                HorizontalAlignment="Right"
                VerticalAlignment="Center"
                Opacity="0.6"
                Text="{Binding FilteredProjects.Count, StringFormat='{}{0} project(s)', FallbackValue='10 project(s)'}" />
            <!--<Button
                Grid.Column="3"
                Margin="5,0,0,0"
                IsEnabled="False"
                Style="{StaticResource CSVButton}" />-->
        </Grid>
        <StackPanel
            Grid.RowSpan="2"
            Grid.Column="2"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Visibility="{Binding ProjectShowing, Converter={StaticResource boolToCollapsed}}">


            <TextBlock
                HorizontalAlignment="Center"
                FontSize="18"
                FontStyle="Italic"
                Opacity="0.6"
                Text="nothing found" />

            <Border
                Grid.Row="3"
                Grid.ColumnSpan="2"
                Width="auto"
                Margin="0,10"
                VerticalAlignment="Top"
                CornerRadius="18">
                <Border.Effect>
                    <DropShadowEffect
                        BlurRadius="20"
                        Direction="220"
                        Opacity="0.2"
                        ShadowDepth="20"
                        Color="Black" />
                </Border.Effect>
                <Border Name="ReceiverColor" CornerRadius="15">
                    <Grid MaxWidth="400" MaxHeight="290">
                        <Border
                            Name="Mask"
                            Background="{StaticResource Purple}"
                            CornerRadius="20" />
                        <Grid x:Name="image">
                            <Image
                                Name="Receiver"
                                MaxWidth="400"
                                MaxHeight="290"
                                gif:AnimationBehavior.AnimateInDesignMode="True"
                                gif:AnimationBehavior.RepeatBehavior="3"
                                gif:AnimationBehavior.SourceUri="pack://application:,,,/Resources/GIF/ron_swanson.gif"
                                RenderOptions.BitmapScalingMode="HighQuality" />
                            <Grid.OpacityMask>
                                <VisualBrush Visual="{Binding ElementName=Mask}" />
                            </Grid.OpacityMask>
                        </Grid>
                    </Grid>
                </Border>
            </Border>

        </StackPanel>

        <ScrollViewer
            x:Name="scroller"
            Grid.RowSpan="2"
            Grid.Column="2"
            ScrollChanged="ScrollViewer_ScrollChanged">
            <StackPanel>

                <Grid
                    MaxWidth="700"
                    Margin="25,20,25,50"
                    Visibility="{Binding ProjectShowing, Converter={StaticResource boolToVisible}}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Border Background="White" CornerRadius="10">
                        <Border.Effect>
                            <DropShadowEffect
                                BlurRadius="30"
                                Opacity="0.4"
                                ShadowDepth="0"
                                Color="Black" />
                        </Border.Effect>
                    </Border>

                    <StackPanel Margin="20">
                        <Grid Margin="0,0,0,30">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock
                                    d:Text="D00000"
                                    FontFamily="Consolas"
                                    Foreground="{StaticResource Teal}"
                                    Style="{StaticResource title}"
                                    Text="{Binding SelectedProject.ProjectCode}" />
                                <TextBlock
                                    FontFamily="Consolas"
                                    Style="{StaticResource title}"
                                    Text=" - " />
                                <TextBlock
                                    d:Text="PROJECT_NAME"
                                    FontFamily="Consolas"
                                    Style="{StaticResource title}"
                                    Text="{Binding SelectedProject.ProjectName}" />
                            </StackPanel>

                            <Border
                                HorizontalAlignment="Right"
                                Background="{StaticResource BlueFaded}"
                                BorderBrush="{StaticResource Blue}"
                                BorderThickness="3,0,0,0"
                                CornerRadius="3">
                                <TextBlock
                                    Margin="20,5"
                                    d:Text="STAGE"
                                    FontSize="20"
                                    FontWeight="SemiBold"
                                    Foreground="{StaticResource Blue}"
                                    Text="{Binding SelectedProject.Stage}" />
                            </Border>


                        </Grid>

                        <Button HorizontalAlignment="Left" Style="{StaticResource Action_Button}" Tag="{Binding SelectedProject.RootDirectory, TargetNullValue='Set Directory'}" d:Tag="DIRECTORY_LINK" Command="{Binding OpenRootDirectoryCmd}"/>

                        <TextBlock Style="{StaticResource section}" Text="{Binding SelectedProject.Archetypes.Count, StringFormat='{}Archetypes [{0}]'}" d:Text="Archetypes [0]" />
                        <ListView ItemsSource="{Binding SelectedProject.Archetypes}">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock
                                        Margin="13,7"
                                        FontWeight="SemiBold"
                                        Text="{Binding Name}" />
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <Grid Margin="0,15,0,0">
                            <TextBlock
                                VerticalAlignment="Center"
                                Style="{StaticResource section}"
                                Text="Attachments" />
                            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                                <Button
                                    Margin="5,0"
                                    IsEnabled="False"
                                    Style="{StaticResource Action_Remove_Button}"
                                    Tag="Remove" />
                                <Button
                                    Margin="5,0"
                                    IsEnabled="False"
                                    Style="{StaticResource Action_New_Button}"
                                    Tag="Add" />
                            </StackPanel>
                        </Grid>

                        <ListView ItemsSource="{Binding SelectedProject.Attachments}">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <uc:DisplayAttachment Attachment="{Binding}"/>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                        
                        <TextBlock Style="{StaticResource section}" Text="Comments" />
                        <uc:DisplayListOfNotes
                            MinHeight="50"
                            Notes="{Binding SelectedProject.Notes}"
                            ShowingEditControls="False" />
                        <Grid
                            x:Name="composeMessageControls"
                            Grid.Row="2"
                            Margin="5">

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                            <TextBox
                                Style="{StaticResource MessageComposer}"
                                Text="{Binding NewMessage, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                TextChanged="TextBox_TextChanged"
                                TextWrapping="WrapWithOverflow" />
                            <Button
                                x:Name="SendButton"
                                Grid.Column="1"
                                Margin="10,0,0,0"
                                Background="Transparent"
                                Command="{Binding SendMessageCmd}"
                                IsEnabled="False"
                                Style="{StaticResource SendButton}" />

                        </Grid>
                    </StackPanel>
                </Grid>
                <StackPanel
                    HorizontalAlignment="Center"
                    Opacity="0.4"
                    Visibility="{Binding ProjectShowing, Converter={StaticResource boolToVisible}}"
                    Orientation="Horizontal">
                    <Path
                        Height="12"
                        Margin="0,2,0,0"
                        Data="M18.5 2H5.5C3.6 2 2 3.6 2 5.5V18.5C2 20.4 3.6 22 5.5 22H16L22 16V5.5C22 3.6 20.4 2 18.5 2M13 16H11V13H8V11H11V8H13V11H16V13H13V16M15 20V18.5C15 16.6 16.6 15 18.5 15H20L15 20Z"
                        Fill="{StaticResource OnBackground}"
                        Stretch="Uniform" />
                    <TextBlock
                        Margin="5,0,0,0"
                        d:Text="Created DATETIME"
                        FontSize="13"
                        FontStyle="Italic"
                        FontWeight="SemiBold"
                        Foreground="{StaticResource OnBackground}"
                        Text="{Binding SelectedProject.CreatedAt, Converter={StaticResource modifiedFormatter}, StringFormat='{}Created {0}'}" />
                    <TextBlock
                        d:Text=" by USERNAME"
                        FontSize="13"
                        FontStyle="Italic"
                        FontWeight="SemiBold"
                        Foreground="{StaticResource OnBackground}"
                        Text="{Binding SelectedProject.CreatedBy, StringFormat='{} by {0}'}" />
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
        <Border
            x:Name="grad"
            Grid.Column="1"
            Height="20"
            VerticalAlignment="Top"
            CornerRadius="20,0,0,0"
            IsHitTestVisible="False">
            <Border.Background>
                <LinearGradientBrush Opacity="0.08" StartPoint="0,1" EndPoint="0,0">
                    <GradientStop Offset="0" Color="Transparent" />
                    <GradientStop Offset="1" Color="Gray" />
                </LinearGradientBrush>
            </Border.Background>
        </Border>
    </Grid>
</UserControl>
