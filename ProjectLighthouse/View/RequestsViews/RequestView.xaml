<UserControl
    x:Class="ProjectLighthouse.View.RequestView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ProjectLighthouse.View"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:uc="clr-namespace:ProjectLighthouse.View.UserControls"
    xmlns:vm="clr-namespace:ProjectLighthouse.ViewModel"
    MaxHeight="1000"
    Background="{StaticResource materialBackground}">

    <UserControl.Resources>
        <ResourceDictionary>
            <Style x:Key="ApproveButton" TargetType="Button">
                <Setter Property="Background" Value="{StaticResource gradGood}" />
                <Setter Property="FontFamily" Value="/Resources/Font/#Proxima Nova" />
                <Setter Property="Foreground" Value="White" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="HorizontalAlignment" Value="Right" />
                <Setter Property="Height" Value="28" />
                <Setter Property="Width" Value="100" />
                <Setter Property="FontWeight" Value="Bold" />
                <Setter Property="Margin" Value="0,5" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border
                                Height="28"
                                Padding="20,0"
                                Background="{TemplateBinding Background}"
                                BorderThickness="0"
                                CornerRadius="14,0,0,14">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{StaticResource materialPrimaryGreen}" />
                        <Setter Property="Foreground" Value="White" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="DeclineButton" TargetType="Button">
                <Setter Property="Background" Value="{StaticResource materialError}" />
                <Setter Property="FontFamily" Value="/Resources/Font/#Proxima Nova" />
                <Setter Property="Foreground" Value="{StaticResource materialOnError}" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="HorizontalAlignment" Value="Left" />
                <Setter Property="Height" Value="28" />
                <Setter Property="Width" Value="100" />
                <Setter Property="FontWeight" Value="Bold" />
                <Setter Property="Margin" Value="0,5" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border
                                Height="28"
                                Padding="20,0"
                                Background="{TemplateBinding Background}"
                                BorderThickness="0"
                                CornerRadius="0,14,14,0">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{StaticResource materialErrorVar}" />
                    </Trigger>
                </Style.Triggers>
            </Style>
            <!--<vm:RequestViewModel x:Key="vm"/>-->
        </ResourceDictionary>
    </UserControl.Resources>
    <!--  DataContext="{StaticResource vm}"  -->


    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" MinWidth="340" />
            <ColumnDefinition Width="20" />
            <ColumnDefinition Width="2*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>


        <ListView
            x:Name="requests_ListView"
            HorizontalContentAlignment="Stretch"
            ItemsSource="{Binding FilteredRequests, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
            ScrollViewer.CanContentScroll="false"
            SelectedItem="{Binding SelectedRequest, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
            SelectionChanged="requests_ListView_SelectionChanged">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <uc:DisplayRequest Request="{Binding}" />
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <StatusBar
            Grid.Row="1"
            Margin="0,5,0,0"
            HorizontalAlignment="Right"
            Background="Transparent">
            <TextBlock Text="{Binding FilteredRequests.Count, StringFormat='{}{0} request(s)'}" />
            <Separator Margin="5,0" Background="LightGray" />
            <TextBlock
                Margin="0,0,10,0"
                VerticalAlignment="Center"
                Text="Filter by:" />
            <ComboBox
                x:Name="filterComboBox"
                Width="100"
                Text="{Binding SelectedFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                <ComboBoxItem Content="Last 14 Days" IsSelected="True" />
                <ComboBoxItem Content="My Requests" />
                <ComboBoxItem Content="Pending" />
                <ComboBoxItem Content="Accepted" />
                <ComboBoxItem Content="Declined" />
                <ComboBoxItem Content="All" />
            </ComboBox>
            <Button
                Margin="0"
                Command="{Binding ExportCommand}"
                Content="CSV"
                Style="{StaticResource ButtonTemplate}" />
        </StatusBar>
        <StackPanel Grid.Column="2" VerticalAlignment="Center">
            <TextBlock
                Grid.Column="2"
                HorizontalAlignment="Center"
                FontSize="30"
                Foreground="#dddddd"
                Text="none found :("
                Visibility="{Binding NothingVis, UpdateSourceTrigger=PropertyChanged}" />
            <TextBlock
                Grid.Column="2"
                HorizontalAlignment="Center"
                FontSize="20"
                FontStyle="Italic"
                Foreground="#dddddd"
                Text="try changing the filter"
                Visibility="{Binding NothingVis, UpdateSourceTrigger=PropertyChanged}" />
        </StackPanel>
        <ScrollViewer
            Grid.RowSpan="2"
            Grid.Column="2"
            MaxWidth="700"
            VerticalScrollBarVisibility="Hidden">
            <Grid Margin="20,10" Visibility="{Binding CardVis, UpdateSourceTrigger=PropertyChanged}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Rectangle RadiusX="10" RadiusY="10">
                    <Rectangle.Effect>
                        <DropShadowEffect
                            BlurRadius="15"
                            Direction="220"
                            Opacity="0.3"
                            RenderingBias="Quality"
                            ShadowDepth="5"
                            Color="#FF000000" />
                    </Rectangle.Effect>
                    <Rectangle.Fill>
                        <SolidColorBrush Color="White" />
                    </Rectangle.Fill>
                </Rectangle>

                <StackPanel Margin="10">
                    <!--  Card Header  -->
                    <Grid DataContext="{Binding}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Grid.ColumnSpan="2"
                            Style="{StaticResource heroTextStyle}"
                            Text="{Binding SelectedRequest.Product, UpdateSourceTrigger=PropertyChanged, FallbackValue='P0XXX.123-456-A2'}" />

                        <Grid Grid.Row="1">
                            <Rectangle
                                Fill="{StaticResource materialPrimary}"
                                RadiusX="5"
                                RadiusY="5" />
                            <TextBlock
                                x:Name="requiredQtyTextBlock"
                                Margin="10,3,10,5"
                                FontSize="18"
                                Foreground="{StaticResource materialOnPrimary}"
                                Text="{Binding SelectedRequest.QuantityRequired, StringFormat='{}{0:#,##0} pcs required', FallbackValue='0 pcs required'}" />
                        </Grid>

                        <TextBlock
                            x:Name="dateRequiredTextBlock"
                            Grid.Row="2"
                            Grid.ColumnSpan="2"
                            Style="{StaticResource subtitleTextStyle}"
                            Text="{Binding SelectedRequest.DateRequired, StringFormat='{}Required for {0:dd/MM/yy}', FallbackValue='Required for 01/01/1970'}" />
                    </Grid>

                    <!--  MetaData Dates display grid  -->
                    <Separator Margin="0,5" />
                    <Grid Margin="5,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="auto" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                        </Grid.RowDefinitions>
                        <TextBlock Style="{StaticResource accentTextStyle}" Text="{Binding SelectedRequest.RaisedBy, UpdateSourceTrigger=PropertyChanged, StringFormat='{}Raised by {0}', FallbackValue='Raised by Randy Marsh'}" />
                        <TextBlock
                            Grid.Column="2"
                            HorizontalAlignment="Right"
                            Style="{StaticResource accentTextStyle}"
                            Text="{Binding SelectedRequest.DateRaised, UpdateSourceTrigger=PropertyChanged, StringFormat='{}{0:dd/MM/yy HH:mm}', FallbackValue='01/01/1970 23:59'}" />

                        <TextBlock
                            Grid.Row="1"
                            Style="{StaticResource accentTextStyle}"
                            Text="{Binding SelectedRequest.ModifiedBy, UpdateSourceTrigger=PropertyChanged, StringFormat='{}Updated by {0}', FallbackValue='Updated by Kyle Brovloski'}"
                            Visibility="{Binding ModifiedVis, UpdateSourceTrigger=PropertyChanged}" />
                        <TextBlock
                            Grid.Row="1"
                            Grid.Column="2"
                            HorizontalAlignment="Right"
                            Style="{StaticResource accentTextStyle}"
                            Text="{Binding SelectedRequest.LastModified, UpdateSourceTrigger=PropertyChanged, StringFormat='{}{0:dd/MM/yy HH:mm}', FallbackValue='01/01/1970 23:59'}"
                            Visibility="{Binding ModifiedVis, UpdateSourceTrigger=PropertyChanged}" />
                    </Grid>

                    <!--  Controls area  -->
                    <Separator Margin="0,5" />
                    <TextBlock
                        Style="{StaticResource subtitleTextStyle}"
                        Text="Decision Making"
                        Visibility="{Binding DecisionVis}" />

                    <StackPanel Margin="10,0" Visibility="{Binding DecisionVis}">

                        <CheckBox
                            Margin="10,5,0,5"
                            Click="CheckBox_Click"
                            Content="Scheduling Approval"
                            IsChecked="{Binding SelectedRequest.isSchedulingApproved, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding SchedulingCheckboxEnabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        <CheckBox
                            Margin="10,5"
                            Click="CheckBox_Click"
                            Content="Production Approval"
                            IsChecked="{Binding SelectedRequest.isProductionApproved, UpdateSourceTrigger=PropertyChanged}"
                            IsEnabled="{Binding ProductionCheckboxEnabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        <TextBlock
                            Grid.Row="2"
                            Style="{StaticResource accentTextStyle}"
                            Text="Reason for declining:" />
                        <ComboBox
                            x:Name="DeclineComboBox"
                            Margin="0,0,0,5"
                            IsEnabled="{Binding DropboxEnabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            Text="{Binding SelectedRequest.DeclinedReason, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}">
                            <ComboBoxItem Content="Uneconomical" />
                            <ComboBoxItem Content="Below MOQ" />
                            <ComboBoxItem Content="Cannot deliver on time" />
                            <ComboBoxItem Content="Machining not possible" />
                            <ComboBoxItem Content="Duplicate request" />
                        </ComboBox>

                        <Grid x:Name="approvalControls" Visibility="{Binding ApprovalControlsVis, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="5" />
                                <RowDefinition Height="auto" />
                                <RowDefinition Height="auto" />
                            </Grid.RowDefinitions>
                            <Button
                                x:Name="DeclineButton"
                                Command="{Binding DeclineCommand}"
                                Content="Decline"
                                Style="{StaticResource CancelButtonTemplate}" />
                            <Button
                                x:Name="ApproveButton"
                                Grid.Column="1"
                                Command="{Binding ApproveCommand}"
                                Content="Approve"
                                Style="{StaticResource GreenButtonTemplate}" />

                        </Grid>
                    </StackPanel>
                    <Grid Margin="10" Visibility="{Binding ApprovedVis, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Rectangle
                            Fill="{StaticResource materialPrimaryGreen}"
                            RadiusX="5"
                            RadiusY="5" />
                        <TextBlock
                            Padding="10,5"
                            FontSize="16"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource materialOnPrimary}"
                            Text="APPROVED" />
                    </Grid>

                    <StackPanel Margin="10,0" Visibility="{Binding ApprovedVis, FallbackValue=Collapsed}">
                        <TextBlock Style="{StaticResource bodyTextStyle}" Text="This request has been approved for manufacture." />
                        <TextBlock
                            Padding="0,5,0,4"
                            Style="{StaticResource bodyTextStyle}"
                            Text="Please enter the Purchase Order reference here:" />
                        <TextBox BorderBrush="{StaticResource materialPrimary}" Text="{Binding PurchaseRef, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Setter Property="Padding" Value="2" />
                                    <Setter Property="FontSize" Value="16" />
                                </Style>
                            </TextBox.Style>
                        </TextBox>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                            <Button
                                Grid.Column="1"
                                Command="{Binding UpdateOrderCommand}"
                                Content="Update Order"
                                IsEnabled="{Binding UpdateButtonEnabled, UpdateSourceTrigger=PropertyChanged}"
                                Style="{StaticResource ButtonTemplate}" />
                        </Grid>
                    </StackPanel>

                    <Grid Margin="10" Visibility="{Binding DeclinedVis, FallbackValue=Collapsed}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Rectangle
                            Fill="{StaticResource materialError}"
                            RadiusX="5"
                            RadiusY="5" />
                        <TextBlock
                            Padding="10,5"
                            FontSize="16"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource materialOnError}"
                            Text="DECLINED" />
                    </Grid>
                    <StackPanel Margin="10,0" Visibility="{Binding DeclinedVis, FallbackValue=Collapsed}">
                        <TextBlock
                            Foreground="{StaticResource materialError}"
                            Style="{StaticResource bodyTextStyle}"
                            Text="Unfortunately this request has been declined, citing the reason below." />
                    </StackPanel>

                    <Separator Margin="0,5" />

                    <StackPanel
                        Grid.Row="2"
                        Margin="10"
                        Visibility="{Binding EditControlsVis, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}">
                        <TextBlock Style="{StaticResource subtitleTextStyle}" Text="Edit Request" />
                        <TextBlock Style="{StaticResource subsubtitleTextStyle}" Text="Quantity Required" />
                        <TextBox
                            x:Name="quantityTextbox"
                            IsEnabled="{Binding CanEditRequirements, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                            Text="{Binding SelectedRequest.QuantityRequired, Mode=OneWay}" />

                        <TextBlock Style="{StaticResource subsubtitleTextStyle}" Text="Date Required" />
                        <DatePicker
                            DisplayDateStart="{x:Static sys:DateTime.Now}"
                            IsEnabled="{Binding CanEditRequirements, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                            SelectedDate="{Binding SelectedRequest.DateRequired, Mode=TwoWay}" />

                        <TextBlock Style="{StaticResource subsubtitleTextStyle}" Text="Notes" />
                        <RichTextBox
                            x:Name="notesTextBox"
                            MinHeight="50"
                            BorderBrush="{StaticResource materialPrimary}"
                            BorderThickness="2">
                            <FlowDocument LineHeight="2" />
                        </RichTextBox>
                        <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                            <Button
                                x:Name="saveChangesButton"
                                Click="saveChangesButton_Click"
                                Content="Save"
                                Style="{StaticResource ButtonTemplate}" />
                        </StackPanel>
                    </StackPanel>
                    <TextBlock Text="{Binding SelectedRequest.Status, StringFormat='{}Status: {0}', FallbackValue='Status: Pending input'}" />
                </StackPanel>

            </Grid>

        </ScrollViewer>
    </Grid>
</UserControl>
