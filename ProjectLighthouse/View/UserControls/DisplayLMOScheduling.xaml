<UserControl x:Class="ProjectLighthouse.View.UserControls.DisplayLMOScheduling"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ProjectLighthouse.View.UserControls"
             xmlns:converters ="clr-namespace:ProjectLighthouse.ViewModel.ValueConverters">

    <UserControl.Resources>
        <converters:intToDays x:Key="inttoday"/>
        <converters:StartDateToEndDate x:Key="startToFinish"/>
        <converters:orderItemToRequirementText x:Key="requirementText"/>

        <Style TargetType="TextBlock" x:Key="itemTextStyle">
            <Setter Property="Foreground" Value="{StaticResource materialOnBackground}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="{StaticResource materialPrimary}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style TargetType="TextBlock" x:Key="itemHeaderStyle">
            <Setter Property="Foreground" Value="{StaticResource materialOnBackground}"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="14"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="{StaticResource materialPrimary}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="10"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Rectangle Fill="{StaticResource materialBackground}" Stroke="#f0f0f0" StrokeThickness="1" Grid.ColumnSpan="2">
            <Rectangle.Effect>
                <DropShadowEffect BlurRadius="20" ShadowDepth="10" Direction="220" Color="Black" Opacity="0.1"/>
            </Rectangle.Effect>
        </Rectangle>
        <Rectangle x:Name="bg" Fill="{StaticResource materialError}"/>


        <Grid Grid.Column="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200" MinWidth="130"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <StackPanel Margin="20,10">
                <TextBlock Text="{Binding Order.Name, FallbackValue='M00001'}" FontSize="26" Foreground="{StaticResource materialOnBackground}" FontWeight="Bold"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Rectangle x:Name="statusBadgeText" Fill="{StaticResource materialError}" RadiusX="2" RadiusY="2"/>
                    <TextBlock Text="{Binding Order.Status, FallbackValue='Ready'}" 
                               Foreground="{StaticResource materialOnPrimary}" 
                               FontSize="14"
                               Padding="10,0,10,2"
                               VerticalAlignment="Center"/>
                </Grid>
                <Button Command="{Binding UpdateCommand}" 
                        CommandParameter="{Binding Order}"
                        Content="edit" 
                        x:Name="editButton"
                        Style="{StaticResource SubtleButtonTemplate}"
                        HorizontalAlignment="Left"
                        Margin="0,5,0,0"/>


            </StackPanel>

            <StackPanel Grid.Column="1" Margin="10">
                <TextBlock Text="{Binding Order.StartDate, StringFormat='{}Start: {0:ddd dd MMM}', FallbackValue='Finish: Mon 01 Jan'}" Style="{StaticResource itemTextStyle}"/>
                <TextBlock Text="{Binding Order, Converter='{StaticResource startToFinish}', StringFormat='{}Finish: {0:ddd dd MMM}', FallbackValue='Finish: Fri 05 Jan'}" Style="{StaticResource itemTextStyle}"/>
                <TextBlock Text="{Binding Order.TimeToComplete, Converter='{StaticResource inttoday}', StringFormat='{}Runtime: {0} days', FallbackValue='Runtime: 5 days'}" Style="{StaticResource itemTextStyle}"/>
                <TextBlock Foreground="{StaticResource materialOnBackground}" Grid.Column="4" VerticalAlignment="Center">
                <Run Text="{Binding Order.BarID}"/>
                <Run Text="{Binding Order.NumberOfBars, StringFormat='{}x {0} bars'}"/>
                </TextBlock>
                
            </StackPanel>
            
            <StackPanel Grid.Column="2" Margin="0,10,20,10" HorizontalAlignment="Right">
                <Grid Margin="0,1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="150"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Product" Style="{StaticResource itemHeaderStyle}"/>
                    <TextBlock Text="Quantity" Style="{StaticResource itemHeaderStyle}" Grid.Column="1" HorizontalAlignment="Right"/>
                    <TextBlock Text="Requirement" Grid.Column="2" Style="{StaticResource itemHeaderStyle}" HorizontalAlignment="Right"/>
                </Grid>

                <ItemsControl ItemsSource="{Binding OrderItems}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="150"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="{Binding Path=ProductName}" Style="{StaticResource itemTextStyle}"/>
                                <TextBlock Text="{Binding Path=TargetQuantity, StringFormat='{}{0:#,##0}'}" Style="{StaticResource itemTextStyle}" Grid.Column="1" HorizontalAlignment="Right"/>
                                <TextBlock Text="{Binding Converter='{StaticResource requirementText}'}" Grid.Column="2" Style="{StaticResource itemTextStyle}" HorizontalAlignment="Right"/>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
